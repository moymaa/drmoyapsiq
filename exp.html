<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Expediente ClÃ­nico Â· Eutimya</title>
<meta name="robots" content="noindex,nofollow"/>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<style>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TOKENS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root {
  --navy:    #0d1b2a;
  --navy2:   #112240;
  --rose:    #c0737a;
  --rose-lt: #d4949a;
  --rose-bg: rgba(192,115,122,.08);
  --rose-bd: rgba(192,115,122,.22);
  --white:   #ffffff;
  --cream:   #f5f3ef;
  --text:    #111827;
  --muted:   #6b7280;
  --border:  rgba(0,0,0,.09);
  --green:   #16a34a;
  --green-bg:rgba(22,163,74,.07);
  --green-bd:rgba(22,163,74,.2);
  --amber-bg:#fef3c7;
  --amber-bd:rgba(234,179,8,.25);
  --amber-tx:#92400e;
  --indigo-bg:rgba(99,102,241,.07);
  --indigo-bd:rgba(99,102,241,.2);
  --indigo:  #6366f1;
}
*,*::before,*::after { box-sizing:border-box; margin:0; padding:0; }
html { -webkit-text-size-adjust:100%; }
body {
  font-family:'DM Sans',system-ui,sans-serif;
  background:var(--white); color:var(--text);
  min-height:100vh; overflow-x:hidden;
}
a { color:inherit; text-decoration:none; }
button { font-family:inherit; cursor:pointer; border:none; background:none; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TOPBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.topbar {
  position:fixed; top:0; left:0; right:0; z-index:200;
  height:56px; display:flex; align-items:center; justify-content:space-between;
  padding:0 20px;
  background:rgba(255,255,255,.96);
  backdrop-filter:blur(12px); -webkit-backdrop-filter:blur(12px);
  border-bottom:1px solid var(--border);
}
.topbar-logo { display:flex; align-items:center; gap:10px; text-decoration:none; }
.topbar-logo img { height:26px; }
.topbar-logo-label { font-size:12px; font-weight:500; letter-spacing:.1em; text-transform:uppercase; color:var(--muted); }
.btn-back {
  display:none; align-items:center; gap:5px;
  font-size:13px; font-weight:500; color:var(--muted);
  transition:color .15s; padding:6px 0;
}
.btn-back.show { display:flex; }
.btn-back:hover { color:var(--text); }
.btn-back svg { width:16px; height:16px; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CONTEXT BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.ctx-banner {
  display:none; position:sticky; top:56px; z-index:100;
  align-items:center; gap:10px;
  padding:10px 20px; font-size:13px; font-weight:600;
}
.ctx-banner.show { display:flex; }
.ctx-banner.navy { background:var(--navy); color:rgba(255,255,255,.85); }
.ctx-banner.amber { background:var(--amber-bg); color:var(--amber-tx); border-bottom:1px solid var(--amber-bd); }
.ctx-num {
  width:22px; height:22px; border-radius:50%;
  background:var(--rose); color:#fff;
  display:flex; align-items:center; justify-content:center;
  font-family:'Playfair Display',serif; font-size:12px; font-weight:700;
  flex-shrink:0;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SCREEN SYSTEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.screen { display:none; padding-top:56px; }
.screen.active { display:block; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SCREEN 0: SELECTOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.selector-wrap {
  min-height:calc(100vh - 56px);
  display:flex; align-items:center; justify-content:center;
  padding:40px 20px 60px;
}
.selector-box { width:100%; max-width:520px; }
.eyebrow {
  font-size:11px; font-weight:700; letter-spacing:.18em; text-transform:uppercase;
  color:var(--rose); margin-bottom:14px;
  display:flex; align-items:center; gap:8px;
}
.eyebrow::before { content:''; width:16px; height:1px; background:var(--rose); }
.page-title {
  font-family:'Playfair Display',serif;
  font-size:clamp(24px,5vw,34px); font-weight:700;
  color:var(--navy); line-height:1.15; margin-bottom:10px;
}
.page-desc { font-size:14px; font-weight:300; color:var(--muted); line-height:1.75; margin-bottom:28px; }

.choices { display:flex; flex-direction:column; gap:10px; }
.choice-btn {
  display:flex; align-items:center; gap:14px;
  padding:18px 20px;
  background:var(--white); border:1.5px solid var(--border);
  border-radius:14px; cursor:pointer; text-align:left; width:100%;
  transition:border-color .18s, box-shadow .18s, transform .12s;
}
.choice-btn:hover {
  border-color:var(--rose);
  box-shadow:0 4px 20px rgba(192,115,122,.1);
  transform:translateY(-1px);
}
.choice-icon {
  width:44px; height:44px; border-radius:12px;
  background:var(--rose-bg);
  display:flex; align-items:center; justify-content:center;
  font-size:20px; flex-shrink:0;
}
.choice-text { flex:1; }
.choice-title { font-size:15px; font-weight:600; color:var(--text); margin-bottom:2px; }
.choice-sub { font-size:12px; font-weight:300; color:var(--muted); line-height:1.5; }
.choice-arrow { color:var(--rose); font-size:22px; flex-shrink:0; transition:transform .18s; }
.choice-btn:hover .choice-arrow { transform:translateX(3px); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FORM SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.form-hero {
  background:var(--navy);
  padding:72px 20px 36px;
  position:relative; overflow:hidden;
}
.form-hero::before {
  content:''; position:absolute; inset:0;
  background:
    radial-gradient(ellipse 70% 60% at 0% 50%, rgba(192,115,122,.18) 0%, transparent 55%),
    radial-gradient(ellipse 50% 40% at 100% 20%, rgba(201,169,110,.09) 0%, transparent 55%),
    radial-gradient(ellipse 40% 50% at 60% 90%, rgba(192,115,122,.07) 0%, transparent 50%);
}
.form-hero-inner { max-width:520px; margin:0 auto; position:relative; z-index:1; }
.form-hero-tag {
  display:inline-flex; align-items:center; gap:7px;
  background:var(--rose-bg); border:1px solid var(--rose-bd);
  border-radius:999px; padding:5px 14px;
  font-size:11px; font-weight:700; letter-spacing:.12em; text-transform:uppercase;
  color:var(--rose-lt); margin-bottom:18px;
}
.form-hero-tag::before { content:''; width:5px; height:5px; border-radius:50%; background:var(--rose); flex-shrink:0; }
.form-hero-title {
  font-family:'Playfair Display',serif;
  font-size:clamp(22px,4.5vw,32px); font-weight:700;
  color:var(--white); line-height:1.15; margin-bottom:10px;
  letter-spacing:-.01em;
}
.form-hero-sub {
  font-size:13px; font-weight:300; color:rgba(255,255,255,.5);
  line-height:1.7; max-width:420px;
}

.form-body { max-width:520px; margin:0 auto; padding:24px 20px 48px; }

.time-row {
  display:flex; align-items:center; gap:10px;
  background:var(--cream); border:1px solid var(--border);
  border-radius:10px; padding:12px 16px; margin-bottom:20px;
}
.time-row .ti { font-size:18px; flex-shrink:0; }
.time-row p { font-size:13px; color:var(--muted); line-height:1.5; }
.time-row strong { color:var(--text); font-weight:600; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FORM CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cards-stack { display:flex; flex-direction:column; gap:10px; }

.fcard {
  background:var(--white); border:1.5px solid var(--border);
  border-radius:14px; overflow:hidden;
  transition:border-color .2s;
}
.fcard.done { border-color:var(--green-bd); }

.fcard-head { display:flex; align-items:center; gap:12px; padding:16px 18px; }
.fcard-num {
  width:34px; height:34px; border-radius:50%;
  border:2px solid var(--rose);
  display:flex; align-items:center; justify-content:center;
  font-family:'Playfair Display',serif; font-size:13px; font-weight:700; color:var(--rose);
  flex-shrink:0; transition:all .2s;
}
.fcard.done .fcard-num {
  background:var(--green); border-color:var(--green);
  color:#fff; font-family:'DM Sans',sans-serif; font-size:16px; font-weight:400;
}
.fcard-info { flex:1; }
.fcard-title { font-size:14px; font-weight:600; color:var(--text); margin-bottom:2px; }
.fcard-sub { font-size:12px; font-weight:300; color:var(--muted); }

.fcard-pills { display:flex; flex-wrap:wrap; gap:5px; padding:0 18px 14px 64px; }
.fcard-pill {
  font-size:11px; font-weight:500; color:var(--rose);
  background:var(--rose-bg); border:1px solid var(--rose-bd);
  padding:2px 8px; border-radius:999px;
}
.fcard.done .fcard-pill { color:var(--green); background:var(--green-bg); border-color:var(--green-bd); }

.fcard-actions {
  display:flex; align-items:center; gap:8px; flex-wrap:wrap;
  padding:12px 18px;
  background:rgba(0,0,0,.015); border-top:1px solid var(--border);
}
.fcard.done .fcard-actions { background:var(--green-bg); }

.btn-fill {
  display:inline-flex; align-items:center; gap:7px;
  background:var(--navy); color:#fff;
  padding:10px 18px; border-radius:8px;
  font-size:13px; font-weight:600;
  transition:background .15s, transform .12s;
}
.btn-fill:hover { background:var(--navy2); transform:translateY(-1px); }
.fcard.done .btn-fill { background:var(--muted); }

.btn-check {
  display:inline-flex; align-items:center; gap:6px;
  border:1.5px solid var(--border); background:var(--white);
  color:var(--muted); padding:9px 14px; border-radius:8px;
  font-size:12px; font-weight:500; transition:all .15s;
}
.btn-check:hover { border-color:var(--green); color:var(--green); background:var(--green-bg); }
.fcard.done .btn-check {
  background:var(--green-bg); border-color:var(--green-bd);
  color:var(--green); font-weight:600; pointer-events:none;
}
.btn-undo {
  margin-left:auto; font-size:11px; color:var(--muted);
  text-decoration:underline; text-underline-offset:3px; transition:color .15s;
}
.btn-undo:hover { color:var(--text); }
.btn-undo[hidden] { display:none; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ESCALAS SELECTOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.select-note {
  display:flex; align-items:flex-start; gap:10px;
  background:var(--amber-bg); border:1px solid var(--amber-bd);
  border-radius:10px; padding:12px 15px; margin-bottom:18px;
}
.select-note .ni { font-size:17px; flex-shrink:0; }
.select-note p { font-size:13px; color:var(--amber-tx); line-height:1.6; }
.select-note strong { font-weight:600; }

/* Section label inside toggle list */
.toggle-section-label {
  font-size:10px; font-weight:800; letter-spacing:.14em; text-transform:uppercase;
  color:var(--muted); padding:6px 4px 4px;
  margin-top:6px;
  display:flex; align-items:center; gap:8px;
}
.toggle-section-label::after { content:''; flex:1; height:1px; background:var(--border); }

.toggle-list { display:flex; flex-direction:column; gap:8px; margin-bottom:20px; }
.escala-toggle {
  display:flex; align-items:flex-start; gap:12px;
  padding:14px 16px; border-radius:12px;
  border:1.5px solid var(--border); background:var(--white);
  cursor:pointer; text-align:left; width:100%;
  transition:border-color .15s, background .15s;
}
.escala-toggle:hover { border-color:var(--rose-bd); background:var(--rose-bg); }
.escala-toggle.on { border-color:var(--rose); background:var(--rose-bg); }

/* Seguimiento toggle variant */
.escala-toggle.seg { border-color:rgba(99,102,241,.18); }
.escala-toggle.seg:hover { border-color:var(--indigo); background:var(--indigo-bg); }
.escala-toggle.seg.on { border-color:var(--indigo); background:var(--indigo-bg); }
.escala-toggle.seg.on .et-box { background:var(--indigo); border-color:var(--indigo); }

.et-box {
  width:20px; height:20px; border-radius:5px;
  border:2px solid var(--border); background:var(--white);
  display:flex; align-items:center; justify-content:center;
  flex-shrink:0; margin-top:1px; transition:all .15s;
  font-size:12px; color:#fff;
}
.escala-toggle.on .et-box { background:var(--rose); border-color:var(--rose); }
.et-body { flex:1; }
.et-title { font-size:14px; font-weight:600; color:var(--text); margin-bottom:2px; }
.et-sub { font-size:12px; font-weight:300; color:var(--muted); line-height:1.5; }

.btn-confirmar {
  width:100%; padding:14px; border-radius:10px;
  background:var(--navy); color:#fff;
  font-size:14px; font-weight:600;
  transition:background .15s, opacity .15s;
}
.btn-confirmar:hover { background:var(--navy2); }
.btn-confirmar:disabled { opacity:.35; cursor:not-allowed; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DONE BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.done-banner {
  display:none;
  background:var(--green-bg); border:1.5px solid var(--green-bd);
  border-radius:16px; padding:28px 24px; text-align:center;
  margin-top:16px; animation:fadeIn .4s ease;
}
.done-banner.show { display:block; }
.done-emoji { font-size:44px; margin-bottom:12px; }
.done-title {
  font-family:'Playfair Display',serif;
  font-size:20px; font-weight:700; color:var(--green); margin-bottom:10px;
}
.done-text { font-size:14px; font-weight:300; color:var(--muted); line-height:1.75; margin-bottom:20px; }
.done-wa {
  display:inline-flex; align-items:center; gap:8px;
  background:#25D366; color:#fff;
  padding:12px 24px; border-radius:10px;
  font-size:14px; font-weight:600; transition:background .15s;
}
.done-wa:hover { background:#22c35e; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DRAWER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.overlay {
  position:fixed; inset:0; z-index:500;
  background:rgba(8,14,22,.72);
  backdrop-filter:blur(5px); -webkit-backdrop-filter:blur(5px);
  opacity:0; visibility:hidden;
  transition:opacity .3s, visibility .3s;
}
.overlay.open { opacity:1; visibility:visible; }

.drawer {
  position:fixed; top:0; right:0; bottom:0; z-index:501;
  width:min(680px, 100vw); background:var(--white);
  display:flex; flex-direction:column;
  transform:translateX(102%);
  transition:transform .38s cubic-bezier(.22,.9,.3,1);
  box-shadow:-16px 0 48px rgba(0,0,0,.18);
}
.drawer.open { transform:translateX(0); }

.dw-head {
  display:flex; align-items:center; justify-content:space-between;
  padding:14px 18px; background:var(--navy);
  border-bottom:1px solid rgba(255,255,255,.06); flex-shrink:0;
}
.dw-info { display:flex; flex-direction:column; gap:2px; }
.dw-label { font-size:10px; font-weight:700; letter-spacing:.14em; text-transform:uppercase; color:var(--rose-lt); }
.dw-title { font-family:'Playfair Display',serif; font-size:16px; font-weight:600; color:#fff; }
.dw-close {
  width:34px; height:34px; border-radius:50%;
  border:1px solid rgba(255,255,255,.15); background:rgba(255,255,255,.07);
  color:rgba(255,255,255,.7); font-size:20px; line-height:1;
  display:flex; align-items:center; justify-content:center;
  transition:background .15s; flex-shrink:0;
}
.dw-close:hover { background:rgba(255,255,255,.15); }

.dw-body { flex:1; overflow:hidden; position:relative; }
.dw-body iframe { width:100%; height:100%; border:none; display:block; }
.dw-loader {
  position:absolute; inset:0; z-index:2; background:var(--white);
  display:flex; flex-direction:column; align-items:center; justify-content:center; gap:14px;
  transition:opacity .35s;
}
.dw-loader.hidden { opacity:0; pointer-events:none; }
.spinner {
  width:32px; height:32px;
  border:3px solid rgba(192,115,122,.15); border-top-color:var(--rose);
  border-radius:50%; animation:spin .8s linear infinite;
}
@keyframes spin { to { transform:rotate(360deg); } }
.dw-loader p { font-size:13px; color:var(--muted); }

.dw-foot {
  padding:12px 18px; background:var(--white);
  border-top:1px solid var(--border); flex-shrink:0;
  display:flex; gap:10px;
}
.btn-dw-done {
  display:inline-flex; align-items:center; gap:7px;
  background:var(--green); color:#fff;
  padding:11px 20px; border-radius:8px; font-size:13px; font-weight:600;
  transition:background .15s;
}
.btn-dw-done:hover { background:#15803d; }
.btn-dw-close {
  display:inline-flex; align-items:center; gap:6px;
  border:1.5px solid var(--border); color:var(--muted);
  padding:10px 16px; border-radius:8px; font-size:13px; font-weight:500;
  background:var(--white); transition:all .15s;
}
.btn-dw-close:hover { border-color:var(--navy); color:var(--navy); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.site-footer {
  background:var(--white); border-top:1px solid var(--border);
  padding:48px 20px 32px;
}
.footer-inner { max-width:520px; margin:0 auto; }
.footer-logo-wrap { margin-bottom:24px; }
.footer-logo-wrap img { width:52px; height:52px; object-fit:contain; }
.footer-cols { display:flex; gap:40px; flex-wrap:wrap; margin-bottom:24px; }
.footer-col h4 {
  font-size:11px; font-weight:800; letter-spacing:.1em; text-transform:uppercase;
  color:var(--text); margin-bottom:12px;
}
.footer-links { display:flex; flex-direction:column; gap:7px; }
.footer-links a {
  font-size:14px; color:var(--muted);
  text-decoration:underline; text-underline-offset:3px; transition:color .15s;
}
.footer-links a:hover { color:var(--text); }
.footer-social {
  display:flex; gap:12px; padding-top:20px;
  border-top:1px solid var(--border); margin-bottom:20px;
}
.soc {
  width:40px; height:40px; border-radius:50%;
  border:1px solid var(--border);
  display:flex; align-items:center; justify-content:center;
  transition:border-color .15s, box-shadow .15s; text-decoration:none;
}
.soc:hover { border-color:rgba(0,0,0,.25); box-shadow:0 2px 8px rgba(0,0,0,.07); }
.soc svg { width:20px; height:20px; fill:none; stroke:rgba(0,0,0,.65); stroke-width:2; stroke-linecap:round; stroke-linejoin:round; }
.footer-legal { font-size:12px; color:var(--muted); line-height:1.65; }
.footer-legal a { color:var(--muted); text-decoration:underline; text-underline-offset:3px; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
@media(max-width:480px) {
  .topbar-logo-label { display:none; }
  .footer-cols { gap:24px; }
}
</style>
</head>
<body>

<!-- TOPBAR -->
<header class="topbar">
  <a href="https://www.eutimya.org/" class="topbar-logo">
    <img src="https://raw.githubusercontent.com/moymaa/drmoyapsiq/main/unnamed.png" alt="Eutimya"/>
    <span class="topbar-logo-label">Eutimya Â· Expediente</span>
  </a>
  <button class="btn-back" id="btnBack" onclick="goBack()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
    Regresar
  </button>
</header>

<!-- CONTEXT BANNER -->
<div class="ctx-banner" id="ctxBanner"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SCREEN 0 â€” SELECTOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen active" id="s0">
  <div class="selector-wrap">
    <div class="selector-box">
      <p class="eyebrow">Eutimya Â· Formularios</p>
      <h1 class="page-title">Â¿QuÃ© formulario necesitas?</h1>
      <p class="page-desc">Selecciona la opciÃ³n que tu mÃ©dico te indicÃ³ o que corresponde a tu situaciÃ³n.</p>
      <div class="choices">
        <button class="choice-btn" onclick="showScreen('s-primera')">
          <div class="choice-icon">ğŸ“‹</div>
          <div class="choice-text">
            <p class="choice-title">Expediente de primera vez</p>
            <p class="choice-sub">Para pacientes que van a tener su primera consulta</p>
          </div>
          <span class="choice-arrow">â€º</span>
        </button>
        <button class="choice-btn" onclick="showScreen('s-bariatrica')">
          <div class="choice-icon">âš•ï¸</div>
          <div class="choice-text">
            <p class="choice-title">Protocolo de cirugÃ­a bariÃ¡trica</p>
            <p class="choice-sub">EvaluaciÃ³n psiquiÃ¡trica pre y postoperatoria</p>
          </div>
          <span class="choice-arrow">â€º</span>
        </button>
        <button class="choice-btn" onclick="showScreen('s-escalas')">
          <div class="choice-icon">ğŸ“Š</div>
          <div class="choice-text">
            <p class="choice-title">Escalas indicadas por mÃ©dico</p>
            <p class="choice-sub">Selecciona las escalas que tu mÃ©dico te solicitÃ³</p>
          </div>
          <span class="choice-arrow">â€º</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SCREEN â€” PRIMERA VEZ
  Ruta directa: ?1
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="s-primera">
  <div class="form-hero">
    <div class="form-hero-inner">
      <div class="form-hero-tag">ğŸ“‹ Primera vez</div>
      <h2 class="form-hero-title">Expediente de primera vez</h2>
      <p class="form-hero-sub">Historia clÃ­nica, datos de identificaciÃ³n y escalas de tamizaje iniciales</p>
    </div>
  </div>
  <div class="form-body">
    <div class="time-row">
      <span class="ti">â±</span>
      <p><strong>~15â€“20 minutos.</strong> Google guarda tu progreso si tienes sesiÃ³n iniciada.</p>
    </div>
    <div class="cards-stack">
      <div class="fcard" id="fc-pv">
        <div class="fcard-head">
          <div class="fcard-num" id="fn-pv">1</div>
          <div class="fcard-info">
            <p class="fcard-title">Expediente clÃ­nico de primera vez</p>
            <p class="fcard-sub">Datos de identificaciÃ³n, antecedentes, medicamentos y escalas generales</p>
          </div>
        </div>
        <div class="fcard-pills">
          <span class="fcard-pill">PHQ-9</span>
          <span class="fcard-pill">GAD-7</span>
          <span class="fcard-pill">ISI</span>
          <span class="fcard-pill">~15â€“20 min</span>
        </div>
        <div class="fcard-actions">
          <p style="font-size:12px;font-weight:300;color:var(--muted);line-height:1.55;margin-bottom:10px;">Al terminar recibirÃ¡s una <strong style="color:var(--text);">copia de tus respuestas al correo</strong> que proporcionaste. Eso confirma que lo recibimos.</p>
          <button class="btn-fill" onclick="openDrawer('pv','Expediente de primera vez','https://docs.google.com/forms/d/e/1FAIpQLSeU7vGbVJSEUdM2av0zKSbLUAHuP-F1KSSKyR0CYzvz0xHybw/viewform?embedded=true')">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
            Llenar formulario
          </button>
        </div>
      </div>
    </div>
    <div class="done-banner" id="done-pv">
      <div class="done-emoji">ğŸ‰</div>
      <p class="done-title">Â¡Muchas gracias!</p>
      <p class="done-text">Hemos recibido tu expediente. Puedes informar a tu mÃ©dico que ya lo completaste.</p>
      <a href="https://wa.me/526731205121" class="done-wa" target="_blank" rel="noopener">ğŸ’¬ WhatsApp</a>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SCREEN â€” BARIÃTRICA (solo)
  Ruta directa: ?tca
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="s-bariatrica">
  <div class="form-hero">
    <div class="form-hero-inner">
      <div class="form-hero-tag">âš•ï¸ Protocolo</div>
      <h2 class="form-hero-title">Protocolo de cirugÃ­a bariÃ¡trica</h2>
      <p class="form-hero-sub">EvaluaciÃ³n psiquiÃ¡trica pre y postoperatoria</p>
    </div>
  </div>
  <div class="form-body">
    <div class="time-row">
      <span class="ti">â±</span>
      <p><strong>~12â€“15 minutos.</strong> Si no recuerdas algÃºn dato puedes dejarlo en blanco.</p>
    </div>
    <div class="cards-stack">
      <div class="fcard" id="fc-bari">
        <div class="fcard-head">
          <div class="fcard-num" id="fn-bari">1</div>
          <div class="fcard-info">
            <p class="fcard-title">EvaluaciÃ³n psiquiÃ¡trica Â· CirugÃ­a bariÃ¡trica</p>
            <p class="fcard-sub">Historia clÃ­nica, hÃ¡bitos alimentarios y escalas especÃ­ficas</p>
          </div>
        </div>
        <div class="fcard-pills">
          <span class="fcard-pill">EAT-26</span>
          <span class="fcard-pill">BES</span>
          <span class="fcard-pill">~12â€“15 min</span>
        </div>
        <div class="fcard-actions">
          <p style="font-size:12px;font-weight:300;color:var(--muted);line-height:1.55;margin-bottom:10px;">Al terminar recibirÃ¡s una <strong style="color:var(--text);">copia de tus respuestas al correo</strong> que proporcionaste. Eso confirma que lo recibimos.</p>
          <button class="btn-fill" onclick="openDrawer('bari','Protocolo de cirugÃ­a bariÃ¡trica','https://docs.google.com/forms/d/e/1FAIpQLSdx-zY35ZlAmlzIvIqBoVpGa4EoiYXl4TtLN1nA36xkURwWVg/viewform?embedded=true')">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
            Llenar formulario
          </button>
        </div>
      </div>
    </div>
    <div class="done-banner" id="done-bari">
      <div class="done-emoji">ğŸ‰</div>
      <p class="done-title">Â¡Muchas gracias!</p>
      <p class="done-text">Hemos recibido tu evaluaciÃ³n. Puedes informar a tu mÃ©dico que ya la completaste.</p>
      <a href="https://wa.me/526731205121" class="done-wa" target="_blank" rel="noopener">ğŸ’¬ WhatsApp</a>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SCREEN â€” PRIMERA VEZ + BARIÃTRICA (combo)
  Ruta directa: ?esb
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="s-combo-bari">
  <div class="form-hero">
    <div class="form-hero-inner">
      <div class="form-hero-tag">âš•ï¸ Protocolo completo</div>
      <h2 class="form-hero-title">Expediente + Protocolo BariÃ¡trica</h2>
      <p class="form-hero-sub">Completa los dos formularios en el orden indicado</p>
    </div>
  </div>
  <div class="form-body">
    <div class="time-row">
      <span class="ti">â±</span>
      <p><strong>~30â€“35 minutos en total.</strong> Puedes tomar descansos entre formularios.</p>
    </div>
    <div class="cards-stack">
      <!-- Card 1 -->
      <div class="fcard" id="fc-cb1">
        <div class="fcard-head">
          <div class="fcard-num" id="fn-cb1">1</div>
          <div class="fcard-info">
            <p class="fcard-title">Expediente de primera vez</p>
            <p class="fcard-sub">Historia clÃ­nica, antecedentes y escalas generales</p>
          </div>
        </div>
        <div class="fcard-pills">
          <span class="fcard-pill">PHQ-9</span><span class="fcard-pill">GAD-7</span><span class="fcard-pill">~15 min</span>
        </div>
        <div class="fcard-actions">
          <p style="font-size:12px;font-weight:300;color:var(--muted);line-height:1.55;margin-bottom:10px;">Al terminar recibirÃ¡s una <strong style="color:var(--text);">copia de tus respuestas al correo</strong> que proporcionaste. Eso confirma que lo recibimos.</p>
          <button class="btn-fill" onclick="openDrawer('cb1','Expediente de primera vez','https://docs.google.com/forms/d/e/1FAIpQLSeU7vGbVJSEUdM2av0zKSbLUAHuP-F1KSSKyR0CYzvz0xHybw/viewform?embedded=true')">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
            Llenar formulario
          </button>
        </div>
      </div>
      <!-- Card 2 -->
      <div class="fcard" id="fc-cb2">
        <div class="fcard-head">
          <div class="fcard-num" id="fn-cb2">2</div>
          <div class="fcard-info">
            <p class="fcard-title">Protocolo de cirugÃ­a bariÃ¡trica</p>
            <p class="fcard-sub">EvaluaciÃ³n psiquiÃ¡trica, hÃ¡bitos alimentarios y escalas especÃ­ficas</p>
          </div>
        </div>
        <div class="fcard-pills">
          <span class="fcard-pill">EAT-26</span><span class="fcard-pill">BES</span><span class="fcard-pill">~12 min</span>
        </div>
        <div class="fcard-actions">
          <p style="font-size:12px;font-weight:300;color:var(--muted);line-height:1.55;margin-bottom:10px;">Al terminar recibirÃ¡s una <strong style="color:var(--text);">copia de tus respuestas al correo</strong> que proporcionaste. Eso confirma que lo recibimos.</p>
          <button class="btn-fill" onclick="openDrawer('cb2','Protocolo de cirugÃ­a bariÃ¡trica','https://docs.google.com/forms/d/e/1FAIpQLSdx-zY35ZlAmlzIvIqBoVpGa4EoiYXl4TtLN1nA36xkURwWVg/viewform?embedded=true')">
            <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
            Llenar formulario
          </button>
        </div>
      </div>
    </div>
    <div class="done-banner" id="done-combo-bari">
      <div class="done-emoji">ğŸ‰</div>
      <p class="done-title">Â¡Muchas gracias!</p>
      <p class="done-text">Hemos recibido los dos formularios. Puedes informar a tu mÃ©dico que ya los completaste.</p>
      <a href="https://wa.me/526731205121" class="done-wa" target="_blank" rel="noopener">ğŸ’¬ WhatsApp</a>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SCREEN â€” ESCALAS (selector + forms dinÃ¡micos)
  Ruta directa: ?es   (selector abierto)
               ?tdah  (ASRS + DIVA auto-confirmados)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="s-escalas">
  <div class="form-hero">
    <div class="form-hero-inner">
      <div class="form-hero-tag">ğŸ“Š Escalas</div>
      <h2 class="form-hero-title" id="escalas-hero-title">Escalas indicadas por mÃ©dico</h2>
      <p class="form-hero-sub" id="escalas-hero-sub">Selecciona las que tu mÃ©dico te indicÃ³ completar</p>
    </div>
  </div>
  <div class="form-body">

    <!-- Paso A: selector -->
    <div id="escalas-selector">
      <div class="select-note">
        <span class="ni">ğŸ“Œ</span>
        <p><strong>Tu mÃ©dico te indicÃ³ cuÃ¡les completar.</strong> Marca todas las que correspondan y presiona continuar.</p>
      </div>

      <div class="toggle-list">

        <!-- â”€â”€ DiagnÃ³stico / Primera vez â”€â”€ -->
        <p class="toggle-section-label">Escalas de diagnÃ³stico</p>

        <button class="escala-toggle" id="tog-asrs" onclick="toggleEscala('asrs')">
          <div class="et-box">âœ“</div>
          <div class="et-body">
            <p class="et-title">Adult ADHD Self-Report Scale (ASRS v1.1)</p>
            <p class="et-sub">Escala de autoreporte de sÃ­ntomas Â· OMS Â· 18 Ã­tems Â· ~5 min</p>
          </div>
        </button>

        <button class="escala-toggle" id="tog-diva" onclick="toggleEscala('diva')">
          <div class="et-box">âœ“</div>
          <div class="et-body">
            <p class="et-title">Entrevista DiagnÃ³stica para el TDAH en adultos (DIVA 2.0)</p>
            <p class="et-sub">Entrevista estructurada completa Â· Historia escolar y laboral Â· ~10 min</p>
          </div>
        </button>

        <button class="escala-toggle" id="tog-tca" onclick="toggleEscala('tca')">
          <div class="et-box">âœ“</div>
          <div class="et-body">
            <p class="et-title">Trastornos de la conducta alimentaria</p>
            <p class="et-sub">EvaluaciÃ³n de hÃ¡bitos, imagen corporal y conductas de riesgo Â· ~8 min</p>
          </div>
        </button>

        <!-- â”€â”€ Seguimiento â”€â”€ -->
        <p class="toggle-section-label">Seguimiento</p>

        <button class="escala-toggle seg" id="tog-seguimiento" onclick="toggleEscala('seguimiento')">
          <div class="et-box">âœ“</div>
          <div class="et-body">
            <p class="et-title">Escalas de seguimiento</p>
            <p class="et-sub">PHQ-9 Â· GAD-7 Â· ISI Â· YMRS â€” todo en un solo formulario Â· ~8â€“10 min</p>
          </div>
        </button>

      </div><!-- /toggle-list -->

      <button class="btn-confirmar" id="btnConfirmar" onclick="confirmarEscalas()" disabled>
        Continuar con las escalas seleccionadas â†’
      </button>
    </div><!-- /escalas-selector -->

    <!-- Paso B: cards generadas -->
    <div id="escalas-forms" style="display:none;">
      <div class="cards-stack" id="escalas-cards"></div>
      <div class="done-banner" id="done-escalas">
        <div class="done-emoji">ğŸ‰</div>
        <p class="done-title">Â¡Muchas gracias!</p>
        <p class="done-text">Hemos recibido todas las escalas. Puedes informar a tu mÃ©dico que ya las completaste.</p>
        <a href="https://wa.me/526731205121" class="done-wa" target="_blank" rel="noopener">ğŸ’¬ WhatsApp</a>
      </div>
    </div>

  </div>
</div>

<!-- OVERLAY + DRAWER -->
<div class="overlay" id="overlay" onclick="closeDrawer()"></div>
<div class="drawer" id="drawer" role="dialog" aria-modal="true">
  <div class="dw-head">
    <div class="dw-info">
      <span class="dw-label">Eutimya Â· Formulario</span>
      <span class="dw-title" id="dw-title-text">Cargando...</span>
    </div>
    <button class="dw-close" onclick="closeDrawer()">Ã—</button>
  </div>
  <div class="dw-body">
    <div class="dw-loader" id="dwLoader"><div class="spinner"></div><p>Cargando formularioâ€¦</p></div>
    <iframe id="formIframe" src="about:blank" title="Formulario" onload="iframeLoaded()"></iframe>
  </div>
</div>

<!-- FOOTER -->
<footer class="site-footer">
  <div class="footer-inner">
    <div class="footer-logo-wrap">
      <img src="https://github.com/moymaa/drmoyapsiq/blob/main/unnamed(30).png?raw=true" alt="Eutimya"/>
    </div>
    <div class="footer-cols">
      <div class="footer-col">
        <h4>Enlaces</h4>
        <div class="footer-links">
          <a href="https://eutimya.org/">Inicio</a>
          <a href="https://www.eutimya.org/agendar">Agendar</a>
          <a href="https://www.eutimya.org/profesionales">Profesionales</a>
          <a href="https://www.eutimya.org/blog">Blog</a>
          <a href="https://www.eutimya.org/nosotros">Nosotros</a>
          <a href="https://www.eutimya.org/validar">Validar</a>
          <a href="https://www.eutimya.org/factura">FacturaciÃ³n</a>
        </div>
      </div>
      <div class="footer-col">
        <h4>Recursos para pacientes</h4>
        <div class="footer-links">
          <a href="https://www.eutimya.org/exp">Registro de expediente</a>
          <a href="https://www.eutimya.org/pagos">Formas de pago</a>
          <a href="https://www.eutimya.org/agendar">Horarios / Reagendar</a>
        </div>
      </div>
    </div>
    <div class="footer-social">
      <a class="soc" href="https://tiktok.com/@eutimya.mental" target="_blank" rel="noopener" aria-label="TikTok">
        <svg viewBox="0 0 24 24"><path d="M14 3v10.1a4.1 4.1 0 1 1-3-3.95"/><path d="M14 3c1.2 2.2 3 3.8 6 4v3c-2.4-.1-4.3-1-6-2.5"/></svg>
      </a>
      <a class="soc" href="mailto:eutimya.mental@gmail.com" aria-label="Email">
        <svg viewBox="0 0 24 24"><path d="M4 6h16v12H4z"/><path d="M4 7l8 6 8-6"/></svg>
      </a>
      <a class="soc" href="https://instagram.com/eutimya.mental" target="_blank" rel="noopener" aria-label="Instagram">
        <svg viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>
      </a>
      <a class="soc" href="https://facebook.com/eutimya.mental" target="_blank" rel="noopener" aria-label="Facebook">
        <svg viewBox="0 0 24 24"><path d="M14 8h3V5h-3c-2.2 0-4 1.8-4 4v3H7v3h3v6h3v-6h3l1-3h-4V9c0-.6.4-1 1-1z"/></svg>
      </a>
    </div>
    <div class="footer-legal">
      Â© Eutimya 2025â€“2026 &nbsp;Â·&nbsp;
      Al usar este sitio, usted acepta el <a href="https://www.eutimya.org/aviso-de-privacidad-y-consentimiento-informado" target="_blank" rel="noopener">Aviso de Privacidad y el Consentimiento Informado.</a>
      ARCO/revocaciÃ³n: <a href="mailto:contacto@eutimya.org">contacto@eutimya.org</a>
    </div>
  </div>
</footer>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ESCALAS DATA
   NOTA: ASRS y DIVA â€” src corregidos (estaban invertidos)
   NOTA: seguimiento â€” reemplaza cada URL_SEGUIMIENTO_* con
         el enlace embebido de tu Google Form correspondiente
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var ESCALAS_DATA = {
  /* â”€â”€ TDAH â”€â”€ */
  asrs: {
    title: 'Adult ADHD Self-Report Scale (ASRS v1.1)',
    sub:   'Escala de autoreporte Â· OMS Â· 18 Ã­tems',
    pills: ['~5 min','18 Ã­tems'],
    src:   'https://docs.google.com/forms/d/e/1FAIpQLSeupeXJte8uaDkoOa7l_dcA9KnXVge-GKDjHRbfUQZKujNeyw/viewform?embedded=true'
  },
  diva: {
    title: 'Entrevista DiagnÃ³stica para el TDAH en adultos (DIVA 2.0)',
    sub:   'Entrevista estructurada completa Â· Historia escolar y laboral',
    pills: ['~10 min','DIVA 2.0'],
    src:   'https://docs.google.com/forms/d/e/1FAIpQLSftISSsoVr3XPM9TdB6CxNDJImzeps1Zm1hksZ7LJi7wzd0yA/viewform?embedded=true'
  },
  /* â”€â”€ TCA â”€â”€ */
  tca: {
    title: 'Trastornos de la conducta alimentaria',
    sub:   'EvaluaciÃ³n de hÃ¡bitos, imagen corporal y conductas de riesgo',
    pills: ['~8 min','EAT-26'],
    src:   'https://docs.google.com/forms/d/e/1FAIpQLSeLQOdnYlkQ1yxrUyVcLl4p_RA9Z_yxYI8ZJhCw22lgIX7i2A/viewform?embedded=true'
  },
  /* â”€â”€ SEGUIMIENTO â”€â”€ formulario Ãºnico */
  seguimiento: {
    title: 'Escalas de seguimiento',
    sub:   'PHQ-9 Â· GAD-7 Â· ISI Â· YMRS â€” en un solo formulario',
    pills: ['~8â€“10 min','PHQ-9','GAD-7','ISI','YMRS'],
    src:   'https://docs.google.com/forms/d/e/1FAIpQLSeLQOdnYlkQ1yxrUyVcLl4p_RA9Z_yxYI8ZJhCw22lgIX7i2A/viewform?embedded=true'
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var navStack = [];

function showScreen(id) {
  var cur = document.querySelector('.screen.active');
  if (cur) navStack.push(cur.id);
  document.querySelectorAll('.screen').forEach(function(s) { s.classList.remove('active'); });
  document.getElementById(id).classList.add('active');
  window.scrollTo(0, 0);
  document.getElementById('btnBack').className = navStack.length ? 'btn-back show' : 'btn-back';
}

function goBack() {
  if (!navStack.length) return;
  var prev = navStack.pop();
  document.querySelectorAll('.screen').forEach(function(s) { s.classList.remove('active'); });
  document.getElementById(prev).classList.add('active');
  window.scrollTo(0, 0);
  document.getElementById('btnBack').className = navStack.length ? 'btn-back show' : 'btn-back';
}

function showDirect(id) {
  document.querySelectorAll('.screen').forEach(function(s) { s.classList.remove('active'); });
  document.getElementById(id).classList.add('active');
  navStack = [];
  document.getElementById('btnBack').className = 'btn-back';
  window.scrollTo(0, 0);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COMPLETION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function markDone(cardId, allIds, bannerId) {
  var card = document.getElementById('fc-' + cardId);
  var num  = document.getElementById('fn-' + cardId);
  var und  = document.getElementById('bu-' + cardId);
  if (card) card.classList.add('done');
  if (num)  num.textContent = 'âœ“';
  if (und)  und.removeAttribute('hidden');

  var allDone = allIds.every(function(id) {
    var c = document.getElementById('fc-' + id);
    return c && c.classList.contains('done');
  });
  if (allDone) {
    var banner = document.getElementById(bannerId);
    if (banner) {
      banner.classList.add('show');
      banner.scrollIntoView({ behavior:'smooth', block:'nearest' });
    }
  }
}

function undoDone(cardId, numLabel, bannerId) {
  var card = document.getElementById('fc-' + cardId);
  var num  = document.getElementById('fn-' + cardId);
  var und  = document.getElementById('bu-' + cardId);
  if (card) card.classList.remove('done');
  if (num)  num.textContent = numLabel;
  if (und)  und.setAttribute('hidden','');
  var banner = document.getElementById(bannerId);
  if (banner) banner.classList.remove('show');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ESCALAS SELECTOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var ALL_KEYS = ['asrs','diva','tca','seguimiento'];
var selected = {};
ALL_KEYS.forEach(function(k) { selected[k] = false; });

function toggleEscala(id) {
  selected[id] = !selected[id];
  var tog = document.getElementById('tog-' + id);
  if (selected[id]) tog.classList.add('on');
  else tog.classList.remove('on');
  var any = ALL_KEYS.some(function(k) { return selected[k]; });
  document.getElementById('btnConfirmar').disabled = !any;
}

function confirmarEscalas() {
  var chosen = ALL_KEYS.filter(function(k) { return selected[k]; });
  var html = '';
  chosen.forEach(function(id, idx) {
    var f = ESCALAS_DATA[id];
    var pills = f.pills.map(function(p) { return '<span class="fcard-pill">'+p+'</span>'; }).join('');
    var safeTitle = f.title.replace(/'/g, '&apos;');
    html +=
      '<div class="fcard" id="fc-'+id+'">'+
        '<div class="fcard-head">'+
          '<div class="fcard-num" id="fn-'+id+'">'+(idx+1)+'</div>'+
          '<div class="fcard-info">'+
            '<p class="fcard-title">'+f.title+'</p>'+
            '<p class="fcard-sub">'+f.sub+'</p>'+
          '</div>'+
        '</div>'+
        '<div class="fcard-pills">'+pills+'</div>'+
        '<div class="fcard-actions">'+
          '<p style="font-size:12px;font-weight:300;color:var(--muted);line-height:1.55;margin-bottom:10px;">Al terminar recibirÃ¡s una <strong style=\"color:var(--text)\">copia de tus respuestas al correo</strong> que proporcionaste. Eso confirma que lo recibimos.</p>'+
          '<button class="btn-fill" onclick="openDrawer(\''+id+'\',\''+safeTitle+'\',\''+f.src+'\')">'+
            '<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>'+
            ' Llenar escala'+
          '</button>'+
          '<button class="btn-undo" id="bu-'+id+'" hidden onclick="undoDone(\''+id+'\','+(idx+1)+',\'done-escalas\')">Desmarcar</button>'+
        '</div>'+
      '</div>';
  });
  document.getElementById('escalas-cards').innerHTML = html;
  document.getElementById('escalas-selector').style.display = 'none';
  document.getElementById('escalas-forms').style.display = 'block';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DRAWER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var activeFormId = null;

function openDrawer(formId, title, src) {
  activeFormId = formId;
  document.getElementById('dw-title-text').textContent = title;
  document.getElementById('dwLoader').classList.remove('hidden');
  document.getElementById('formIframe').src = src;
  document.getElementById('drawer').classList.add('open');
  document.getElementById('overlay').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeDrawer() {
  document.getElementById('drawer').classList.remove('open');
  document.getElementById('overlay').classList.remove('open');
  document.body.style.overflow = '';
}

function iframeLoaded() {
  var f = document.getElementById('formIframe');
  if (f.src !== 'about:blank') {
    document.getElementById('dwLoader').classList.add('hidden');
  }
}

function doneFromDrawer() {
  closeDrawer();
  if (!activeFormId) return;
  var activeScreen = document.querySelector('.screen.active');
  if (!activeScreen) return;
  var sid = activeScreen.id;

  if      (sid === 's-primera')     markDone(activeFormId, ['pv'], 'done-pv');
  else if (sid === 's-bariatrica')  markDone(activeFormId, ['bari'], 'done-bari');
  else if (sid === 's-combo-bari') {
    markDone(activeFormId, ['cb1','cb2'], 'done-combo-bari');
  }
  else if (sid === 's-escalas') {
    var chosen = ALL_KEYS.filter(function(k) { return selected[k]; });
    markDone(activeFormId, chosen, 'done-escalas');
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   URL ROUTING â€” tabla de parÃ¡metros
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ?1     â†’ solo primera vez
   ?esb   â†’ expediente + bariÃ¡trica (combo)
   ?tdah  â†’ ASRS + DIVA auto-confirmados
   ?tca   â†’ solo protocolo bariÃ¡trica
   ?es    â†’ selector de escalas (abierto)
   (sin parÃ¡metros) â†’ pantalla de selecciÃ³n
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function route() {
  var p   = new URLSearchParams(window.location.search);
  var has = function(k) { return p.has(k); };

  /* ?1 â€” solo primera vez */
  if (has('1')) {
    showDirect('s-primera');
    return;
  }

  /* ?esb â€” expediente + bariÃ¡trica */
  if (has('esb')) {
    showDirect('s-combo-bari');
    return;
  }

  /* ?tdah â€” ASRS + DIVA auto-confirmados */
  if (has('tdah')) {
    selected.asrs = true; selected.diva = true;
    document.getElementById('tog-asrs').classList.add('on');
    document.getElementById('tog-diva').classList.add('on');
    document.getElementById('btnConfirmar').disabled = false;
    showDirect('s-escalas');
    setTimeout(confirmarEscalas, 80);
    return;
  }

  /* ?tca â€” solo protocolo bariÃ¡trica */
  if (has('tca')) {
    showDirect('s-bariatrica');
    return;
  }

  /* ?es â€” selector de escalas */
  if (has('es')) {
    showDirect('s-escalas');
    return;
  }

  /* Sin parÃ¡metros â†’ pantalla de selecciÃ³n */
}

function showBanner(cls, html) {
  var b = document.getElementById('ctxBanner');
  b.className = 'ctx-banner show ' + cls;
  b.innerHTML = html;
}

document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') closeDrawer();
});

route();
</script>
</body>
</html>
